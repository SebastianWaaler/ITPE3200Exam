@model QuizApp.Models.Question
@using System.Text.Json
@using System.Linq

@{
    ViewData["Title"] = "Delete Question";

    var optionsList = Model.Options?.ToList() ?? new List<QuizApp.Models.Option>();

    var initialState = new {
        id = Model.Id,
        quizId = Model.QuizId,
        text = Model.Text ?? "",
        points = Model.Points,
        quizTitle = Model.Quiz?.Title ?? "",
        options = optionsList.Select(o => new {
            text = o.Text ?? "",
            isCorrect = o.IsCorrect
        })
    };

    var initialJson = JsonSerializer.Serialize(initialState);
}

<h2>Delete Question</h2>

<div id="delete-question-app">

    <p class="text-muted">
        Are you sure you want to delete this question from
        <strong>{{ quizTitle }}</strong>?
    </p>

    <div class="card mb-3">
        <div class="card-body">

            <dl class="row mb-0">
                <dt class="col-sm-3">Text</dt>
                <dd class="col-sm-9">{{ text }}</dd>

                <dt class="col-sm-3">Points</dt>
                <dd class="col-sm-9">{{ points }}</dd>

                <dt class="col-sm-3">Options</dt>
                <dd class="col-sm-9">{{ options.length }}</dd>
            </dl>

            <ul class="mt-2" v-if="options.length">
                <li v-for="(opt, idx) in options"
                    :key="idx"
                    :style="opt.isCorrect ? 'font-weight:bold;color:green' : ''">

                    {{ opt.text }} <span v-if="opt.isCorrect">(correct)</span>

                </li>
            </ul>

        </div>
    </div>

    <form asp-action="Delete" method="post">
        @Html.AntiForgeryToken()

        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="QuizId" />

        <button type="submit" class="btn btn-danger">Delete</button>

        <a asp-controller="Quiz"
           asp-action="Details"
           asp-route-id="@Model.QuizId"
           class="btn btn-outline-secondary">
            Cancel
        </a>
    </form>

</div>

@section Scripts {
    <script>
        const initial = @Html.Raw(initialJson);
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    id: initial.id,
                    quizId: initial.quizId,
                    text: initial.text,
                    points: initial.points,
                    quizTitle: initial.quizTitle,
                    options: initial.options
                };
            }
        }).mount("#delete-question-app");

        window.addEventListener("error", e => {
            console.error("Client error on Delete Question page:", e.error || e.message);
        });
    </script>
}
