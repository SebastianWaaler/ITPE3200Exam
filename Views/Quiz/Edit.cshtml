@model QuizApp.Models.Quiz
@using System.Text.Json

@{
    ViewData["Title"] = "Edit Quiz";

    var quizJson = JsonSerializer.Serialize(new {
        quizId = Model.QuizId,
        title = Model.Title ?? "",
        description = Model.Description ?? ""
    });
}

<h2>Edit Quiz</h2>

<div id="quiz-edit-app">

    <div class="mb-3">
        <label>Title</label>
        <input class="form-control" v-model="title" />
    </div>

    <div class="mb-3">
        <label>Description</label>
        <textarea class="form-control" v-model="description"></textarea>
    </div>

    <button class="btn btn-primary" @@click="updateQuiz">Save</button>
    <a class="btn btn-secondary" :href="`/Quiz`">Cancel</a>

</div>

@section Scripts {
<script type="module">
    import QuizService from "/js/QuizService.js";
    const { createApp } = Vue;

    const initial = @Html.Raw(quizJson);

    createApp({
        data() {
            return {
                quizId: initial.quizId,
                title: initial.title,
                description: initial.description
            };
        },
        methods: {
            async updateQuiz() {
                try {
                    await QuizService.update({
                        quizId: this.quizId,  
                        title: this.title,
                        description: this.description
                    });

                    window.location.href = `/Quiz`;
                }
                catch (err) {
                    console.error(err);
                    alert("Failed to update quiz.");
                }
            }
        }
    }).mount("#quiz-edit-app");

    window.addEventListener("error", function (event) {
        console.error("Client error on Edit Quiz page:", event.error || event.message);
        alert("Something went wrong on this page. Please try again.");
    });
</script>
}
