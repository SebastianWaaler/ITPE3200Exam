@model QuizApp.Models.Quiz
@using System.Text.Json

@{
    ViewData["Title"] = "Quiz Details";

    var initialJson = JsonSerializer.Serialize(new {
        quizId = Model.QuizId,
        title = Model.Title ?? "",
        description = Model.Description ?? "",
        questions = Model.Questions.Select(q => new {
            id = q.Id,
            text = q.Text,
            points = q.Points,
            options = q.Options.Select(o => new {
                id = o.Id,
                text = o.Text,
                isCorrect = o.IsCorrect
            })
        })
    });
}

<div id="quiz-details-app">

    <h2>{{ quiz.title }}</h2>
    <p>{{ quiz.description }}</p>

    <h3>Questions</h3>

    <div v-if="quiz.questions.length === 0">
        <p>No questions added yet.</p>

        <a class="btn btn-primary"
           :href="'/Questions/Create?quizId=' + quiz.quizId">
            Add First Question
        </a>
    </div>

    <div v-else>
        <a class="btn btn-success mb-3"
           :href="'/Questions/Create?quizId=' + quiz.quizId">
            Add Question
        </a>

        <ul class="list-group">
            <li class="list-group-item"
                v-for="q in quiz.questions"
                :key="q.id">

                <strong>{{ q.text }}</strong>
                ({{ q.points }} points)

                <ul>
                    <li v-for="opt in q.options"
                        :key="opt.id"
                        :style="opt.isCorrect ? 'color:green;font-weight:bold' : ''">
                        
                        {{ opt.text }}
                        <span v-if="opt.isCorrect">âœ“</span>
                    </li>
                </ul>

                <a :href="'/Questions/Edit/' + q.id">Edit</a>
                |
                <a :href="'/Questions/Delete/' + q.id">Delete</a>

            </li>
        </ul>
    </div>
    <a class="btn btn-secondary" :href="`/Quiz`">Cancel</a>

</div>

@section Scripts {

    <script>
        const { createApp } = Vue;

        const initial = @Html.Raw(initialJson);

        createApp({
            data() {
                return {
                    quiz: initial
                };
            }
        }).mount("#quiz-details-app");
        window.addEventListener("error", (event) => {
            console.error("Client error on Quiz Details page:", event.error || event.message);
            alert("Something went wrong. Please try again.");
        });
    </script>
}
