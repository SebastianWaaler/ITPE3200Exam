@model Quiz
@using System.Text.Json

@{
    ViewData["Title"] = "Create Quiz";

    // Prepare Vue initial state safely as JSON    
    var state = new {
        title = Model?.Title ?? "",
        description = Model?.Description ?? ""
    };

    var json = JsonSerializer.Serialize(state);
}

<h2 class="mb-4">Create Quiz</h2>

<div id="quiz-create-app">

    <div class="mb-3">
        <label>Title</label>
        <input class="form-control" v-model="title" />
    </div>

    <div class="mb-3">
        <label>Description</label>
        <textarea class="form-control" v-model="description"></textarea>
    </div>

    <button class="btn btn-primary" @@click="saveQuiz">Save</button>
    <a class="btn btn-secondary" href="/Quiz">Cancel</a>
</div>

@section Scripts {
<script type="module">
    import QuizService from "/js/QuizService.js";
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                title: "",
                description: ""
            };
        },
        methods: {
            async saveQuiz() {

                // Build quiz object for API
                const q = {
                    title: this.title,
                    description: this.description
                };

                // Call API to create quiz
                const created = await QuizService.create(q);

                // FIX â†’ Use quizId (API returns quizId, not id)
                window.location.href = `/Quiz/Details/${created.quizId}`;
            }
        }
    }).mount("#quiz-create-app");

    // Client-side error handler
    window.addEventListener("error", function (event) {
        console.error("Client error on Create Quiz page:", event.error || event.message);
        alert("Something went wrong on this page. Please try again.");
    });
</script>
}
